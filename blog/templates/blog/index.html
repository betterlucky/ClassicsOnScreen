{% extends "base.html" %}

{% block page_title %}
    <h2 class="mb-4">Upcoming Shows</h2>
{% endblock page_title %}

{% block page_content %}
    {% block shows %}
        {% regroup shows by eventtime.date as shows_by_date %}
        
        {% for date_group in shows_by_date %}
            <h3>{{ date_group.grouper|date:"l, F j, Y" }}</h3>
            <ul>
                {% for show in date_group.list %}
                    <li>
                        {{ show.eventtime|time:"g:i A" }} - 
                        <a href="{% url 'blog_location' show.location.name %}">
                            {{ show.location.name }}
                        </a> | 
                        Film: <a href="{% url 'blog_film' show.film.name %}">
                            {{ show.film.name }}
                        </a>
                        <p>{{ show.body|slice:":400" }}...</p>
                        <p>Event suggested by 
                            <a href="{% url 'profile' show.created_by %}"> {{ show.created_by }} </a> 
                            on {{ show.created_on|date:"F j, Y" }}
                        </p>
                        <p>Tickets sold so far: {{ show.credits }}</p>
                        <p>Current show status: {{ show.status }}</p>
                        <form method="post" action="{% url 'add_credits_to_show' show.id %}">
                            {% csrf_token %}
                            <label for="credits">Add Credits:</label>
                            <input type="number" name="credits" id="credits" min="1" required>
                            <button type="submit">Add Credits</button>
                        </form>
                    </li>
                {% endfor %}
            </ul>
        {% endfor %}
    {% endblock shows %}
{% endblock page_content %}

